<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard - Taskify</title>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Inter&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0; font-family: 'Inter', sans-serif; background: #fff; color: #000;
    display: flex; height: 100vh; overflow: hidden;
  }
  #sidebar {
    background: #f9faff; width: 220px; padding: 20px; box-sizing: border-box;
    display: flex; flex-direction: column;
  }
  #sidebar a {
    margin: 12px 0; text-decoration: none; color: #000; font-weight: 600; font-size: 16px;
  }
  #sidebar a.active {
    color: #0056b3; font-weight: 700;
  }
  #sidebar a:hover {
    color: #0056b3;
  }
  #sidebar .spacer { flex-grow: 1; }
  #main {
    flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;
  }
  footer {
    text-align: center; font-size: 14px; padding: 15px 10px; background: #f0f4ff; color: #555;
    font-family: 'Inter', sans-serif; box-shadow: 0 -1px 3px #ddd;
  }
  .content {
    flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column;
    gap: 20px; max-width: 1200px; margin: 0 auto; box-sizing: border-box;
  }
  /* Panel 1: Top wide block: Today's Tasks + Daily Timeline */
  .panel1 {
    display: flex; gap: 20px;
  }
  .todays-tasks {
    flex: 2; background: #f0f8ff; border-radius: 8px; padding: 20px;
    display: flex; flex-direction: column; max-height: 500px; overflow-y: auto;
  }
  .todays-tasks h2 {
    font-family: 'Merriweather', serif; color: #0056b3; margin-bottom: 10px;
  }
  .task-list {
    list-style: none; padding: 0; margin: 0; flex-grow: 1; overflow-y: auto;
  }
  .task-list li {
    padding: 8px 6px; margin-bottom: 6px; background: #e6f0ff; border-radius: 4px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .task-list li.completed {
    text-decoration: line-through; color: #888;
    background: #d6eaff;
  }
  .task-actions button {
    margin-left: 6px; background: transparent; border: none; cursor: pointer; color: #0056b3;
    font-weight: 700;
  }
  .add-task-form {
    margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;
  }
  .add-task-form input, .add-task-form button {
    padding: 6px 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;
  }
  .add-task-form button {
    background: #0056b3; color: white; cursor: pointer;
    border: none;
  }
  .daily-timeline {
    flex: 1; background: #f7fbff; border-radius: 8px; padding: 10px;
    display: flex; flex-direction: column; overflow-y: auto; max-height: 500px;
  }
  .timeline-hour {
    border-top: 1px solid #ccc; height: 40px; position: relative;
    font-size: 12px; color: #888; padding-left: 5px;
  }
  .timeline-hour:first-child {
    border-top: none;
  }
  .task-block {
    position: absolute; left: 50px; right: 5px; background: #99c2ff;
    border-radius: 4px; padding: 3px 6px; font-size: 13px; cursor: pointer;
    color: #003366;
    box-sizing: border-box;
  }
  .task-block.completed {
    background: #c2d9ff; color: #666;
    text-decoration: line-through;
  }
  /* Panel 2: Below panel 1: Tomorrow and Weekly tasks side by side */
  .panel2 {
    display: flex; gap: 20px;
  }
  .task-slab {
    flex: 1; background: #f0f8ff; border-radius: 8px; padding: 20px;
    max-height: 250px; overflow-y: auto;
  }
  .task-slab h3 {
    font-family: 'Merriweather', serif; color: #0056b3; margin-bottom: 10px;
  }
  .task-slab ul {
    list-style: none; padding: 0; margin: 0;
  }
  .task-slab li {
    margin-bottom: 6px; padding: 6px 4px; background: #e6f0ff; border-radius: 4px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .task-slab li.completed {
    text-decoration: line-through; color: #888;
    background: #d6eaff;
  }
  /* Panel 3: right below panel2, 3 equal boxes horizontally */
  .panel3 {
    display: flex; gap: 20px; margin-top: 10px;
  }
  .panel-box {
    flex: 1; background: #f0f8ff; border-radius: 8px; padding: 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  .panel-box h3 {
    font-family: 'Merriweather', serif; color: #0056b3; margin-bottom: 15px;
  }
  /* Pie chart container */
  #progressChart {
    width: 160px; height: 160px;
  }
  /* Pomodoro timer styles */
  #timerDisplay {
    font-size: 48px; font-weight: 700; margin-bottom: 20px;
    color: #003366;
  }
  .timer-controls button {
    padding: 8px 16px; margin: 0 5px; font-weight: 600;
    border: none; border-radius: 5px; cursor: pointer;
  }
  .timer-controls button#startBtn {background: #007bff; color: white;}
  .timer-controls button#pauseBtn {background: #ffc107; color: black;}
  .timer-controls button#resetBtn {background: #dc3545; color: white;}
  /* Friends list */
  #friendsList {
    width: 100%; max-height: 200px; overflow-y: auto;
  }
  #friendsList li {
    background: #dbe9ff; margin-bottom: 8px; padding: 8px 12px; border-radius: 6px;
    display: flex; justify-content: space-between; align-items: center;
  }
  #friendsList li span.friend-name {
    font-weight: 600; color: #003366;
  }
  #friendsList li span.friend-since {
    font-size: 12px; color: #666;
  }
  #friendsList li button.delete-friend {
    background: transparent; border: none; color: #dc3545; cursor: pointer; font-weight: 700;
  }
  .add-friend-form {
    margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;
    justify-content: center;
  }
  .add-friend-form input, .add-friend-form button {
    padding: 6px 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;
  }
  .add-friend-form button {
    background: #0056b3; color: white; cursor: pointer;
    border: none;
  }
</style>
</head>
<body>
  <nav id="sidebar">
    <a href="#" class="active">Dashboard</a>
    <a href="calendar.html">Calendar</a>
    <a href="track.html">Track</a>
    <a href="reports.html">Reports</a>
    <a href="help.html">Help & Support</a>
    <a href="settings.html">Settings</a>
    <div class="spacer"></div>
  </nav>

  <div id="main">
    <div class="content">

      <!-- PANEL 1 -->
      <div class="panel1">

        <!-- Today's Tasks -->
        <section class="todays-tasks">
          <h2>Today's Tasks</h2>
          <ul id="todayTaskList" class="task-list"></ul>

          <form id="addTaskForm" class="add-task-form" autocomplete="off">
            <input type="text" id="taskName" placeholder="Task name (required)" required />
            <input type="date" id="taskDate" />
            <input type="time" id="taskTime" />
            <button type="submit">Add Task</button>
          </form>
        </section>

        <!-- Daily Timeline -->
        <section class="daily-timeline" aria-label="Daily timeline with hourly tasks">
          <!-- Hours with tasks will be appended here -->
        </section>

      </div>

      <!-- PANEL 2 -->
      <div class="panel2">

        <!-- Tomorrow Tasks -->
        <section class="task-slab">
          <h3>Tomorrow</h3>
          <ul id="tomorrowTaskList"></ul>
        </section>

        <!-- Weekly Tasks -->
        <section class="task-slab">
          <h3>This Week</h3>
          <ul id="weeklyTaskList"></ul>
        </section>

      </div>

      <!-- PANEL 3 -->
      <div class="panel3">

        <!-- Task Progress Pie Chart -->
        <section class="panel-box" aria-label="Task progress chart">
          <h3>Task Progress</h3>
          <canvas id="progressChart" width="160" height="160"></canvas>
          <div id="progressPercent" style="margin-top:10px; font-weight:700; color:#003366;"></div>
        </section>

        <!-- Pomodoro Timer -->
        <section class="panel-box" aria-label="Focus timer">
          <h3>Pomodoro Timer</h3>
          <div id="timerDisplay">25:00</div>
          <div class="timer-controls">
            <button id="startBtn">Start</button>
            <button id="pauseBtn" disabled>Pause</button>
            <button id="resetBtn">Reset</button>
          </div>
        </section>

        <!-- Friends Tab -->
        <section class="panel-box" aria-label="Friends list">
          <h3>Friends</h3>
          <ul id="friendsList"></ul>
          <form id="addFriendForm" class="add-friend-form" autocomplete="off">
            <input type="text" id="friendName" placeholder="Friend's name" required />
            <button type="submit">Add Friend</button>
          </form>
        </section>

      </div>

    </div>

    <footer>
      © 2025 built for Developer’s Club | Built with hopes of getting recruited | Anjana CS24B2014
    </footer>
  </div>

<script>
(() => {
  // UTILITIES
  function formatDate(date) {
    const d = new Date(date);
    let dd = d.getDate();
    let mm = d.getMonth() + 1;
    let yyyy = d.getFullYear();
    if (dd < 10) dd = '0' + dd;
    if (mm < 10) mm = '0' + mm;
    return `${yyyy}-${mm}-${dd}`;
  }
  function formatDisplayDate(date) {
    const d = new Date(date);
    let dd = d.getDate();
    let mm = d.getMonth() + 1;
    let yyyy = d.getFullYear();
    if (dd < 10) dd = '0' + dd;
    if (mm < 10) mm = '0' + mm;
    return `${dd}/${mm}/${yyyy}`;
  }
  function todayString() {
    return formatDate(new Date());
  }
  function tomorrowString() {
    let t = new Date();
    t.setDate(t.getDate() + 1);
    return formatDate(t);
  }
  function isSameDate(d1, d2) {
    return new Date(d1).toDateString() === new Date(d2).toDateString();
  }
  function isWithinNextWeek(date) {
    const now = new Date();
    const d = new Date(date);
    const diff = d - now;
    return diff > 0 && diff <= 7 * 24 * 60 * 60 * 1000;
  }

  // STORAGE KEYS
  const TASKS_KEY = 'taskify_tasks';
  const FRIENDS_KEY = 'taskify_friends';

  // STATE
  let tasks = [];
  let friends = [];

  // DOM ELEMENTS
  const todayTaskList = document.getElementById('todayTaskList');
  const tomorrowTaskList = document.getElementById('tomorrowTaskList');
  const weeklyTaskList = document.getElementById('weeklyTaskList');
  const addTaskForm = document.getElementById('addTaskForm');
  const dailyTimeline = document.querySelector('.daily-timeline');

  const progressPercent = document.getElementById('progressPercent');
  const progressChartCtx = document.getElementById('progressChart').getContext('2d');

  const timerDisplay = document.getElementById('timerDisplay');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');

  const friendsList = document.getElementById('friendsList');
  const addFriendForm = document.getElementById('addFriendForm');

  // --- TASKS ---

  function saveTasks() {
    localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
  }
  function loadTasks() {
    const stored = localStorage.getItem(TASKS_KEY);
    tasks = stored ? JSON.parse(stored) : [];
  }

  function sortTasksByPriorityAndTime(taskArray) {
    return taskArray.slice().sort((a,b) => {
      if(a.priority !== b.priority) return b.priority - a.priority; // Higher priority first
      if(a.date && b.date) {
        if(a.date === b.date && a.time && b.time) {
          return a.time.localeCompare(b.time);
        }
        return a.date.localeCompare(b.date);
      }
      return 0;
    });
  }

  // Add task, priority hardcoded 1 for now, can be extended
  function addTask(name, date, time) {
    tasks.push({
      id: Date.now() + Math.random(),
      name: name,
      date: date || null,
      time: time || null,
      completed: false,
      priority: 1
    });
    saveTasks();
    renderAll();
  }

  function toggleTaskCompleted(id) {
    const t = tasks.find(t => t.id === id);
    if (t) {
      t.completed = !t.completed;
      saveTasks();
      renderAll();
    }
  }
  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
    renderAll();
  }

  // --- FRIENDS ---
  function saveFriends() {
    localStorage.setItem(FRIENDS_KEY, JSON.stringify(friends));
  }
  function loadFriends() {
    const stored = localStorage.getItem(FRIENDS_KEY);
    friends = stored ? JSON.parse(stored) : [];
  }
  function addFriend(name) {
    friends.push({
      id: Date.now() + Math.random(),
      name: name,
      since: todayString()
    });
    saveFriends();
    renderFriends();
  }
  function deleteFriend(id) {
    friends = friends.filter(f => f.id !== id);
    saveFriends();
    renderFriends();
  }

  // --- RENDERING ---

  // Create LI for task, with checkbox, name, time (if any), edit and delete buttons
  function createTaskLI(task, toggleHandler, deleteHandler) {
    const li = document.createElement('li');
    li.className = task.completed ? 'completed' : '';
    const label = document.createElement('label');
    label.style.flex = '1';
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = task.completed;
    checkbox.addEventListener('change', () => toggleHandler(task.id));
    label.appendChild(checkbox);
    const text = document.createElement('span');
    text.textContent = task.name;
    text.style.marginLeft = '8px';
    label.appendChild(text);

    if (task.time) {
      const timeSpan = document.createElement('span');
      timeSpan.textContent = ' @ ' + task.time;
      timeSpan.style.marginLeft = '10px';
      timeSpan.style.fontSize = '12px';
      timeSpan.style.color = '#555';
      label.appendChild(timeSpan);
    }

    li.appendChild(label);

    const actions = document.createElement('div');
    actions.className = 'task-actions';

    // Delete button
    const delBtn = document.createElement('button');
    delBtn.textContent = 'Delete';
    delBtn.title = 'Delete task';
    delBtn.addEventListener('click', () => deleteHandler(task.id));
    actions.appendChild(delBtn);

    li.appendChild(actions);
    return li;
  }

  function renderTaskList(taskArray, ulElement) {
    ulElement.innerHTML = '';
    const sorted = sortTasksByPriorityAndTime(taskArray);
    sorted.forEach(t => {
      ulElement.appendChild(createTaskLI(t, toggleTaskCompleted, deleteTask));
    });
  }

  // DAILY TIMELINE
  // Show hours 0 to 23, for each hour show tasks with that hour time

  function renderDailyTimeline(dateStr) {
    dailyTimeline.innerHTML = '';
    const tasksForDate = tasks.filter(t => t.date === dateStr);
    // Create 24 hour blocks
    for(let h=0; h<24; h++) {
      const hourDiv = document.createElement('div');
      hourDiv.className = 'timeline-hour';
      hourDiv.style.position = 'relative';
      let hourLabel = h.toString().padStart(2,'0') + ':00';
      hourDiv.textContent = hourLabel;

      // Tasks that match this hour
      const tasksThisHour = tasksForDate.filter(t => {
        if(!t.time) return false;
        return t.time.startsWith(hourLabel.substring(0,2));
      });

      tasksThisHour.forEach(task => {
        const taskDiv = document.createElement('div');
        taskDiv.className = 'task-block' + (task.completed ? ' completed' : '');
        taskDiv.textContent = task.name + (task.time ? ' (' + task.time + ')' : '');
        // clicking toggles completed
        taskDiv.addEventListener('click', () => {
          toggleTaskCompleted(task.id);
        });
        // Position task block within hour block, stacked vertically
        taskDiv.style.top = '2px';
        hourDiv.appendChild(taskDiv);
      });

      dailyTimeline.appendChild(hourDiv);
    }
    // Show tasks without time at bottom
    const tasksWithoutTime = tasksForDate.filter(t => !t.time);
    if (tasksWithoutTime.length) {
      const noTimeDiv = document.createElement('div');
      noTimeDiv.className = 'timeline-hour';
      noTimeDiv.style.position = 'relative';
      noTimeDiv.style.fontWeight = '600';
      noTimeDiv.textContent = 'Tasks without time:';
      tasksWithoutTime.forEach(task => {
        const taskDiv = document.createElement('div');
        taskDiv.className = 'task-block' + (task.completed ? ' completed' : '');
        taskDiv.textContent = task.name;
        taskDiv.style.top = '2px';
        taskDiv.addEventListener('click', () => toggleTaskCompleted(task.id));
        noTimeDiv.appendChild(taskDiv);
      });
      dailyTimeline.appendChild(noTimeDiv);
    }
  }

  // RENDER ALL TASKS + TIMELINE
  function renderAll() {
    const today = todayString();
    const tomorrow = tomorrowString();

    // Filter tasks by date for each list
    const todayTasks = tasks.filter(t => t.date === today);
    const tomorrowTasks = tasks.filter(t => t.date === tomorrow);
    const weeklyTasks = tasks.filter(t => {
      if (!t.date) return false;
      return isWithinNextWeek(t.date) && t.date !== today && t.date !== tomorrow;
    });

    renderTaskList(todayTasks, todayTaskList);
    renderTaskList(tomorrowTasks, tomorrowTaskList);
    renderTaskList(weeklyTasks, weeklyTaskList);

    renderDailyTimeline(today);

    renderProgressChart();
  }

  // --- TASK PROGRESS PIE CHART ---

  let chart = null;
  function renderProgressChart() {
    const today = todayString();
    const todayTasks = tasks.filter(t => t.date === today);
    if(todayTasks.length === 0){
      progressPercent.textContent = 'No tasks today';
      if(chart){
        chart.clear();
      }
      return;
    }
    const completedCount = todayTasks.filter(t => t.completed).length;
    const percent = Math.round((completedCount / todayTasks.length) * 100);
    progressPercent.textContent = `${percent}% completed`;

    if(chart) {
      chart.destroy();
      chart = null;
    }

    // Draw pie chart with Canvas API
    const ctx = progressChartCtx;
    const radius = 80;
    ctx.clearRect(0,0,160,160);

    // Draw completed slice
    const completedAngle = (percent / 100) * 2 * Math.PI;
    ctx.beginPath();
    ctx.moveTo(80, 80);
    ctx.fillStyle = '#0056b3';
    ctx.arc(80, 80, radius, -Math.PI/2, -Math.PI/2 + completedAngle);
    ctx.closePath();
    ctx.fill();

    // Draw remaining slice
    ctx.beginPath();
    ctx.moveTo(80, 80);
    ctx.fillStyle = '#e6f0ff';
    ctx.arc(80, 80, radius, -Math.PI/2 + completedAngle, -Math.PI/2 + 2 * Math.PI);
    ctx.closePath();
    ctx.fill();

    // Draw inner white circle for donut effect
    ctx.beginPath();
    ctx.fillStyle = '#fff';
    ctx.arc(80, 80, radius * 0.6, 0, 2 * Math.PI);
    ctx.fill();

    // Text in center
    ctx.fillStyle = '#0056b3';
    ctx.font = '20px Merriweather, serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(`${percent}%`, 80, 80);
  }

  // --- POMODORO TIMER ---

  let pomodoroInterval = null;
  let pomodoroSecondsLeft = 25 * 60;
  let timerRunning = false;

  function updateTimerDisplay() {
    const m = Math.floor(pomodoroSecondsLeft / 60).toString().padStart(2,'0');
    const s = (pomodoroSecondsLeft % 60).toString().padStart(2,'0');
    timerDisplay.textContent = `${m}:${s}`;
  }

  function startTimer() {
    if(timerRunning) return;
    timerRunning = true;
    startBtn.disabled = true;
    pauseBtn.disabled = false;

    pomodoroInterval = setInterval(() => {
      pomodoroSecondsLeft--;
      updateTimerDisplay();
      if(pomodoroSecondsLeft <= 0) {
        clearInterval(pomodoroInterval);
        timerRunning = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        alert('Pomodoro session complete!');
      }
    }, 1000);
  }
  function pauseTimer() {
    if(!timerRunning) return;
    clearInterval(pomodoroInterval);
    timerRunning = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }
  function resetTimer() {
    clearInterval(pomodoroInterval);
    pomodoroSecondsLeft = 25 * 60;
    updateTimerDisplay();
    timerRunning = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }

  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resetBtn.addEventListener('click', resetTimer);

  updateTimerDisplay();

  // --- FRIENDS ---

  function renderFriends() {
    friendsList.innerHTML = '';
    friends.forEach(friend => {
      const li = document.createElement('li');
      const nameSpan = document.createElement('span');
      nameSpan.className = 'friend-name';
      nameSpan.textContent = friend.name;
      const sinceSpan = document.createElement('span');
      sinceSpan.className = 'friend-since';
      sinceSpan.textContent = 'Friend since ' + formatDisplayDate(friend.since);

      li.appendChild(nameSpan);
      li.appendChild(sinceSpan);

      const delBtn = document.createElement('button');
      delBtn.className = 'delete-friend';
      delBtn.textContent = 'X';
      delBtn.title = 'Remove friend';
      delBtn.addEventListener('click', () => {
        if(confirm(`Remove friend "${friend.name}"?`)) {
          deleteFriend(friend.id);
        }
      });
      li.appendChild(delBtn);

      friendsList.appendChild(li);
    });
  }

  // --- FORM HANDLERS ---

  addTaskForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('taskName').value.trim();
    const date = document.getElementById('taskDate').value || todayString();
    const time = document.getElementById('taskTime').value || null;
    if (!name) {
      alert('Task name is required');
      return;
    }
    addTask(name, date, time);
    addTaskForm.reset();
  });

  addFriendForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('friendName').value.trim();
    if (!name) {
      alert('Friend name is required');
      return;
    }
    addFriend(name);
    addFriendForm.reset();
  });

  // LOAD & INIT
  function init() {
    loadTasks();
    loadFriends();
    renderAll();
    renderFriends();
  }
  init();
})();
</script>
</body>
</html>
